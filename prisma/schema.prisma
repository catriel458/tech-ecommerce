generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  nombre    String
  role      Role     @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  carrito   CarritoItem[]
  ordenes   Orden[]
}

enum Role {
  USER
  ADMIN
}

model Producto {
  id          String   @id @default(cuid())
  nombre      String
  descripcion String
  precio      Float
  stock       Int
  imagen      String?
  categoria   Categoria
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  carritoItems CarritoItem[]
  ordenItems   OrdenItem[]
}

enum Categoria {
  PROCESADORES
  PLACAS_MADRE
  MEMORIA_RAM
  TARJETAS_GRAFICAS
  ALMACENAMIENTO
  FUENTES
  GABINETES
  REFRIGERACION
  MONITORES
  TECLADOS
  MOUSE
  AURICULARES
  SILLAS_GAMING
  NOTEBOOKS
  PC_ARMADAS
  STREAMING
  REDES
  ACCESORIOS
}

model CarritoItem {
  id         String   @id @default(cuid())
  cantidad   Int      @default(1)
  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  productoId String
  producto   Producto @relation(fields: [productoId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())
  
  @@unique([userId, productoId])
}

model Orden {
  id        String      @id @default(cuid())
  total     Float
  estado    EstadoOrden @default(PENDIENTE)
  userId    String
  user      User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  items     OrdenItem[]
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
}

enum EstadoOrden {
  PENDIENTE
  PROCESANDO
  ENVIADO
  ENTREGADO
  CANCELADO
}

model OrdenItem {
  id            String   @id @default(cuid())
  cantidad      Int
  precioUnitario Float
  ordenId       String
  orden         Orden    @relation(fields: [ordenId], references: [id], onDelete: Cascade)
  productoId    String
  producto      Producto @relation(fields: [productoId], references: [id])
  createdAt     DateTime @default(now())
}